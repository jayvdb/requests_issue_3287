matrix:
  include:
    - language: python
      python: 2.7
      virtualenv:
        system_site_packages: true
      sudo: required
      dist: trusty
      addons:
        apt:
          sources:
            - debian-sid
          packages:
            - python-requests
            # avoid dependency on latest python-cryptography
            - python-openssl=0.13-2ubuntu6
            - python-ndg-httpsclient
            - python-pyasn1

script:
  - pip install --upgrade PyOpenSSL cryptography

  # Show urllib3 is unbundled from requests
  - ls $(python -c "import os.path, requests; print(os.path.dirname(requests.__file__))")/packages/

  - python show.py

  - python -c "import requests; requests.get('https://www.wikipedia.org/')"
  - python -c "import requests; requests.get('https://self-signed.badssl.com/')" || true
  - python -c "import requests; requests.get('https://testssl-expire-r2i2.disig.sk/index.en.html')" || true
